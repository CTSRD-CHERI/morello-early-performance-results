<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Baseline and comparison framework - Early performance results from the prototype Morello microarchitecture</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../cover/index.html">Early performance results from the prototype Morello microarchitecture</a></li><li class="chapter-item expanded "><a href="../introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../headline-results/index.html"><strong aria-hidden="true">2.</strong> Headline results</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../headline-results/architectural-integration.html"><strong aria-hidden="true">2.1.</strong> Architectural integration</a></li><li class="chapter-item expanded "><a href="../headline-results/software-ecosystem-enablement.html"><strong aria-hidden="true">2.2.</strong> Software ecosystem enablement</a></li><li class="chapter-item expanded "><a href="../headline-results/microarchitectural-objectives.html"><strong aria-hidden="true">2.3.</strong> Microarchitectural objectives</a></li><li class="chapter-item expanded "><a href="../headline-results/dynamic-performance.html"><strong aria-hidden="true">2.4.</strong> Dynamic performance</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../headline-results/essential-overheads.html"><strong aria-hidden="true">2.4.1.</strong> Essential overheads</a></li><li class="chapter-item expanded "><a href="../headline-results/initial-measured-performance.html"><strong aria-hidden="true">2.4.2.</strong> Initial measured performance results</a></li><li class="chapter-item expanded "><a href="../headline-results/next-steps.html"><strong aria-hidden="true">2.4.3.</strong> Next steps</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../performance-methodology/index.html"><strong aria-hidden="true">3.</strong> Performance methodology</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../performance-methodology/baseline-and-comparison-framework.html" class="active"><strong aria-hidden="true">3.1.</strong> Baseline and comparison framework</a></li><li class="chapter-item expanded "><a href="../performance-methodology/morello-microarchitectural-limitations.html"><strong aria-hidden="true">3.2.</strong> Morello microarchitectural limitations</a></li><li class="chapter-item expanded "><a href="../performance-methodology/abis-code-generation-and-compilation.html"><strong aria-hidden="true">3.3.</strong> ABIs, code generation, and compilation</a></li></ol></li><li class="chapter-item expanded "><a href="../performance-analysis-spec/index.html"><strong aria-hidden="true">4.</strong> Performance analysis of SPECint 2006</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../performance-analysis-spec/specint-2006-benchmark-suite.html"><strong aria-hidden="true">4.1.</strong> SPECint 2006 benchmark suite</a></li><li class="chapter-item expanded "><a href="../performance-analysis-spec/specific-hardware-and-software.html"><strong aria-hidden="true">4.2.</strong> Specific hardware and software configurations</a></li><li class="chapter-item expanded "><a href="../performance-analysis-spec/initial-results.html"><strong aria-hidden="true">4.3.</strong> Initial results</a></li></ol></li><li class="chapter-item expanded "><a href="../caveats/index.html"><strong aria-hidden="true">5.</strong> Caveats</a></li><li class="chapter-item expanded "><a href="../future-work/index.html"><strong aria-hidden="true">6.</strong> Future work</a></li><li class="chapter-item expanded "><a href="../version-history/index.html"><strong aria-hidden="true">7.</strong> Version history</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Early performance results from the prototype Morello microarchitecture</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/CTSRD-CHERI/morello-early-performance-results" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="baseline-and-comparison-framework"><a class="header" href="#baseline-and-comparison-framework">Baseline and comparison framework</a></h1>
<h2 id="hardware"><a class="header" href="#hardware">Hardware</a></h2>
<p>Despite being based on the Neoverse N1 configured as found in the N1SDP,
performance results gathered on Morello are not directly comparable.
Most importantly, cache sizes and other aspects of the memory subsystem differ
between the designs.
Instead, direct comparisons must be performed between multiple software
configurations on Morello.</p>
<p>In addition, measurements in this report are made on an FPGA-adapted
implementation of Morello, with three variants used:</p>
<ul>
<li><strong>Baseline Morello design</strong> modeled on the shipped Morello SoC.</li>
<li><strong>Modified Morello design with data-dependent exception fix</strong> correcting a
microarchitectural issue with exception delivery (see below for details).</li>
<li><strong>Modified Morello design with data-dependent exception fix and increased
store queue size</strong> expanding the store queue sizes to address increased queue
pressure due to the presence of capability stores, on top of the above
modified design.</li>
</ul>
<p>In general, third parties will only have access to unmodified Morello SoCs.
However, they should see similar results to those we describe for the baseline
Morello design on FPGA.</p>
<p>All Morello configurations operated at a fixed frequency during
benchmarks<sup class="footnote-reference"><a href="#1">1</a></sup>, with execution time measured in clock cycles for the purposes
of calculating overheads.</p>
<h2 id="software"><a class="header" href="#software">Software</a></h2>
<p>In general, comparisons in this report seek to contrast the dynamic behavior
of memory-unsafe code with memory-safe code on Morello.
To understand the essential pointer-size costs of CHERI, we also introduce a
fourth form of code, P128, with two variations.
This will allow us to model ‘optimal’ performance with the current
microarchitecture.
Our experiments set up comparisons between five forms of code:</p>
<ul>
<li><strong>Hybrid (aarch64) code</strong>, which employs capabilities only where explicitly
annotated in C and C++.</li>
<li><strong>Purecap ABI (aarch64c) code</strong>, which employs capabilities ubiquitously in
the implementation of CHERI C and C++, including both sub-language pointers
(e.g., stack pointers, GOT pointers, and return addresses) and
language-level pointers (e.g., pointer variables pointing at heap
allocations, stack allocations, or functions).</li>
<li><strong>Benchmark ABI (aarch64c) code</strong>, which has modified code generation to
work around a lack of capability-awareness in the shipped Morello branch
predictor (described below).
This code retains an identical memory footprint and near-identical code
generation to pure-capability aarch64c C/C++ code, but has reduced
protection behavior.
See below for more information on this ABI.</li>
<li><strong>P128 code</strong>, which is a modified form of aarch64 code in which pointer
footprints are widened to 128 bits from 64 bits, while still implemented as
64-bit integers rather than capabilities.
See below for more information on this compilation mode.</li>
<li><strong>P128 Forced-GOT code</strong>, which, unlike P128, which allows access to global
variables via PC-derived pointers, forces the indirection of all global
access via a Global Offset Table (GOT) to emulate the potential worst-case
addition of capability indirection that could be experienced with
pure-capability code. See below for more information on this compilation
mode.</li>
</ul>
<p>We recommend that code be compiled with optimization for performance enabled,
which we believe currently achieves the best comparison; it is especially
important that code compiled with -O0 not be compared between ABIs, due to
current inefficiency in unoptimized CHERI code generation, eliminated with
even basic optimization.
With respect to -O1 and above, we are still coming to understand how some
optimization passes should interact with capabilities (e.g., SROA, global
merging, GVN, and others), and some optimisations are therefore presently
inhibited.</p>
<p>One implication of using the hybrid ABI rather than baseline aarch64 is that
library implementations of memory-copying routines that have been updated for
capability tag propagation, such as memcpy(), will be capability-aware and use
capability-based portions of the instruction set.
This maximizes comparability in an area where there has not yet been
substantial dynamic performance analysis and optimization, but with the
limitation that hybrid code might be able to achieve better performance if it
used highly optimized copying routines not yet available for CHERI-generated
code.
Another consideration is that the baseline Armv8.2-a architecture underlying
Morello predates dedicated memory-copy instructions<sup class="footnote-reference"><a href="#2">2</a></sup>.
If these new instructions were suitably adapted to handle CHERI alignment, tag
propagation, and bounds enforcement, they would enable comparable
hardware-based optimization for capability-enabled memory copying.</p>
<p>For the purposes of these measurements, which focus on userlevel performance,
we have used the CheriBSD 22.12 hybrid kernel.
Debugging features such as kernel invariants checking (INVARIANTS) and dynamic
kernel lock order verification (WITNESS) are left enabled, and should not
contribute significantly for these workloads.
Userlevel malloc debugging is disabled. CheriBSD is compiled with -O2,
including its system libraries.</p>
<p>The SPECint benchmark suite is compiled with -O3. SPEC is statically linked in
all presented results.</p>
<p>By default, CheriBSD 22.12 ships with unoptimized third-party libraries (compiled with -O0), to improve debugging in the initial release, and those would not be suitable for benchmarking; we intend to provide packages built with optimizations enabled in the future. SPECint does not have external software dependencies beyond the system library, and so our work is not affected. If we were dependent on third-party packages, as might be true of other benchmark suites, we would need to investigate optimization settings for those packages. </p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>The FPGA setup used in these measurements does not implement thermal
throttling.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>Weidmann, <a href="https://community.arm.com/arm-community-blogs/b/architectures-and-processors-blog/posts/arm-a-profile-architecture-developments-2021">Arm A-Profile Architecture Developments
2021</a>.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../performance-methodology/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../performance-methodology/morello-microarchitectural-limitations.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../performance-methodology/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../performance-methodology/morello-microarchitectural-limitations.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
